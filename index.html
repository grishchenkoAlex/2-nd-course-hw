<!DOCTYPE html>
<html>

<head>
  <title>Проект "Комменты"</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <ul class="comments">
      <li class="comment">
        <div class="comment-header">
          <div>Глеб Фокин</div>
          <div>12.02.22 12:18</div>
        </div>
        <div class="comment-body">
          <div class="comment-text">
            Это будет первый комментарий на этой странице
          </div>
        </div>
        <div class="comment-footer">
          <div class="likes">
            <span class="likes-counter">3</span>
            <button class="like-button"></button>
          </div>
        </div>
      </li>
      <li class="comment">
        <div class="comment-header">
          <div>Варвара Н.</div>
          <div>13.02.22 19:22</div>
        </div>
        <div class="comment-body">
          <div class="comment-text">
            Мне нравится как оформлена эта страница! ❤
          </div>
        </div>
        <div class="comment-footer">
          <div class="likes">
            <span class="likes-counter">75</span>
            <button class="like-button -active-like"></button>
          </div>
        </div>
      </li>
    </ul>
    <div class="add-form">
      <input type="text" class="add-form-name" placeholder="Введите ваше имя" required />
      <textarea type="textarea" class="add-form-text" placeholder="Введите ваш коментарий" rows="4" required></textarea>
      <section class="buttonGroup">
        <div class="add-form-row">
          <button class="add-form-button">Написать</button>
        </div>
        <div class="add-form-row">
          <button class="remove-form-button">Удалить последний комментарий</button>
        </div>
      </section>
    </div>
  </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="./template-engine.js"></script>
<script>
  const PLACEHOLDER_NAME = "Введите ваше имя";
  const PLACEHOLDER_COMMENT = "Введите ваш коментарий";
  const PLACEHOLDER_NAME__ERROR = "Поле имени обязательно для заполнения";
  const PLACEHOLDER_COMMENT__ERROR = "Поле комментария обязательно для заполнения";

  const inputName = document.querySelector('.add-form-name');
  const inputComment = document.querySelector('.add-form-text');
  const button = document.querySelector('.add-form-button');
  const formText = document.querySelector('.add-form');
  const buttonRemove = document.querySelector('.remove-form-button');
  const comments = document.querySelector('.comments');
  let arrayValue = [inputName, inputComment];

  // Валидация формы
  function validateForm(arrayValue) {
    for (let i = 0; i < arrayValue.length; i++) {

      if (arrayValue[i].value == "") {
        if (i == 0) {
          inputName.classList.add('error');
          inputName.placeholder = PLACEHOLDER_NAME__ERROR;
        } else {
          inputComment.classList.add('error');
          inputComment.placeholder = PLACEHOLDER_COMMENT__ERROR;
        }
      }
    }
  }

  // Доп задание: Блокирование кнопки при незаполненных полях
  for (let i = 0; i < arrayValue.length; i++) {
    arrayValue[i].addEventListener('input', function () {
      const allInputsFilled = Array.from(arrayValue).every(input => input.value.trim() !== '');
      if (allInputsFilled) {
        button.removeAttribute('disabled');
      } else {
        button.disabled = true;
      }
    });
  }

  // Доп задание: срабатывание кода на Enter
  document.addEventListener('keyup', (event) => {
    if (event.key === 'Enter') {
      inputName.placeholder = PLACEHOLDER_NAME;
      inputComment.placeholder = PLACEHOLDER_NAME;
      inputName.classList.remove('error');
      inputComment.classList.remove('error');


      validateForm(arrayValue);


      // Добавление комментария шаблонизатором
      if (!inputName.classList.contains('error') && !inputComment.classList.contains('error')) {

        function CommentEngineTemplate(comment) {

          return {
            tag: 'li',
            cls: 'comment',
            content: [
              {
                tag: 'div',
                cls: 'comment-header',
                content: [
                  {
                    tag: 'div',
                    content: `${inputName.value}`
                  },
                  {
                    tag: 'div',
                    content: `${moment().format('DD.MM.YY HH:mm')}`
                  },
                ]
              },
              {
                tag: 'div',
                cls: 'comment-body',
                content:
                {
                  tag: 'div',
                  cls: 'comment-text',
                  content: `${inputComment.value}`,
                }
              },
              {
                tag: 'div',
                cls: 'comment-footer',
                content:
                {
                  tag: 'div',
                  cls: 'likes',
                  content: [
                    {
                      tag: 'span',
                      cls: 'likes-counter',
                      content: `${Math.floor(Math.random() * 101)}`,
                    },
                    {
                      tag: 'button',
                      cls: 'like-button'
                    }
                  ]
                }
              }
            ]
          }
        }

        const cart = templateEngine(CommentEngineTemplate(arrayValue[0]));

        const comments = document.querySelector('.comments');
        comments.appendChild(cart)


      }

    }
  })

  //срабатывание кода на click
  button.addEventListener('click', (event) => {
    event.preventDefault();


    inputName.placeholder = PLACEHOLDER_NAME;
    inputComment.placeholder = PLACEHOLDER_NAME;
    inputName.classList.remove('error');
    inputComment.classList.remove('error');


    validateForm(arrayValue);


    // Добавление комментария шаблонизатором
    if (!inputName.classList.contains('error') && !inputComment.classList.contains('error')) {

      function CommentEngineTemplate(comment) {

        return {
          tag: 'li',
          cls: 'comment',
          content: [
            {
              tag: 'div',
              cls: 'comment-header',
              content: [
                {
                  tag: 'div',
                  content: `${inputName.value}`
                },
                {
                  tag: 'div',
                  content: `${moment().format('DD.MM.YY HH:mm')}`
                },
              ]
            },
            {
              tag: 'div',
              cls: 'comment-body',
              content:
              {
                tag: 'div',
                cls: 'comment-text',
                content: `${inputComment.value}`,
              }
            },
            {
              tag: 'div',
              cls: 'comment-footer',
              content:
              {
                tag: 'div',
                cls: 'likes',
                content: [
                  {
                    tag: 'span',
                    cls: 'likes-counter',
                    content: `${Math.floor(Math.random() * 101)}`,
                  },
                  {
                    tag: 'button',
                    cls: 'like-button'
                  }
                ]
              }
            }
          ]
        }
      }

      const cart = templateEngine(CommentEngineTemplate(arrayValue[0]));

      const comments = document.querySelector('.comments');
      comments.appendChild(cart)


    }


  })
  
  // Доп. задание: Добавление кнопки удаление последнего комментария
  buttonRemove.addEventListener('click', (event) => {
    event.preventDefault();

    const lastChild = comments.lastElementChild;
    lastChild.remove();

  })
</script>

</html>